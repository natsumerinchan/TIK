#!/bin/bash
Yeliqin() { echo -e "[36;5m$*[0m"; }
content=$(curl -s https://v1.jinrishici.com/all.json)
  shiju=$(echo $content| cut -d \" -f 4 )
  from=$(echo $content| cut -d \" -f 8)
  author=$(echo $content| cut -d \" -f 12)
  ver=5.1
  cloud=$(curl -s "https://gitee.com/xiaobai2333/CYToolkitAccount/blob/master/version.md" | grep -w $ver | sed -n '2p' | cut -c 1-3)
  clou=$(echo $cloud | cut -c 1-3)
  if [[ $clou != $ver ]]; then
  version="æœ‰æ›´æ–°"
  mains=1
  else
  version="æ— æ›´æ–°"
  mains=0
  fi
dyunboot=1
LOCALDIR="$(cd $(dirname $0); pwd)"
binner=$LOCALDIR/bin
HOST=$(uname)
platform=$(uname -m)
AIK="$binner/AIK"
export LD_LIBRARY_PATH=$binner/$HOST/$platform/lib64
export ebinner=$binner/$HOST/$platform
export PS1="[\e[32;1m\u@\h \W]\\$" 
source $binner/settings
source $binner/function2
if [ "$platform" = "aarch64" ];then
command+=" -b /sdcard"
Sourcedir=/sdcard/$mydir
else
Sourcedir=$LOCALDIR
fi
if [[ -f "$binner/sta" ]]; then
	new=0
else
	new=1
fi

# æ£€æŸ¥æ˜¯å¦éœ€è¦å®‰è£…ç¯å¢ƒ
function checkpath()
{
clear
cd $LOCALDIR
if [[ -f "$binner/depment" ]]; then
promenu
else
clear
echo -n æ‚¨&&sleep 0.2&&echo -n å¥½&&sleep 0.2&&echo -n ï¼Œ&&sleep 0.2&&echo -n æ¬¢&&sleep 0.2&&echo -n è¿&&sleep 0.2&&echo -n ä½¿&&sleep 0.2&&echo -n ç”¨&&sleep 0.2&&echo -n  TIK &&sleep 0.2&&echo å…¨èƒ½å·¥å…·ç®±ï¼&&sleep 0.2
echo -n å°†&&sleep 0.2&&echo -n é€š&&sleep 0.2&&echo -n è¿‡&&sleep 0.2&&echo -n å‡ &&sleep 0.2&&echo -n ä¸ª&&sleep 0.2&&echo -n æ­¥&&sleep 0.2&&echo -n éª¤&&sleep 0.2&&echo -n ï¼Œ&&sleep 0.2&&echo -n å¸®&&sleep 0.2&&echo -n æ‚¨&&sleep 0.2&&echo -n é…&&sleep 0.2&&echo -n ç½®&&sleep 0.2&&echo -n å¥½&&sleep 0.2&&echo -n å·¥&&sleep 0.2&&echo å…·&&sleep 0.2
PIP_MIRROR=https://pypi.tuna.tsinghua.edu.cn/simple/
clear
echo -e "\033[34m $(cat $binner/banner) \033[0m"
#if [[ $(which id) ]]; then
#if [[ $(id -u) = "0" ]]; then
#userid="root"
#fi
#elif [[ $EUID = "0" ]]; then
#userid="root"
#fi
if [[ $userid = "root" ]]; then
	clear
	echo "å·¥å…·ä¸å…è®¸åœ¨rootç¯å¢ƒä¸‹è¿è¡Œ"
	sleep $sleeptime
	exit
fi
Yeliqin "å¼€å§‹é…ç½®ç¯å¢ƒ"
sleep $sleeptime
clear
echo "æ›´æ¢å›½å†…æ¸…åæº ..."
if [ "$platform" = "aarch64" ];then
	mv /etc/apt/sources.list /etc/apt/sources.list.bak
	echo -e "deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-updates main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-backports main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-security main restricted universe multiverse" >> /etc/apt/sources.list
else
	sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
	sudo sed -i 's/archive.ubuntu.com/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list
	sudo sed -i 's/security.ubuntu.com/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list
fi
sudo sed -i '/%sudo/c %sudo  ALL=(ALL:ALL)  NOPASSWD:ALL' /etc/sudoers
sudo apt-get update && sudo apt-get upgrade -y >/dev/null
clear
echo æ­£åœ¨å®‰è£…å¿…å¤‡çš„è½¯ä»¶åŒ…...
sudo apt-get install python3 python3-pip default-jre bc cpio android-sdk-libsparse-utils aria2 openjdk-11-jre p7zip-full -y >/dev/null 2>&1
pip3 install protobuf -i $PIP_MIRROR >/dev/null 2>&1
pip3 install beautifulsoup4 -i $PIP_MIRROR >/dev/null 2>&1
pip3 install requests -i $PIP_MIRROR >/dev/null 2>&1
pip3 install pycryptodome -i $PIP_MIRROR >/dev/null 2>&1
pip3 install docopt -i $PIP_MIRROR >/dev/null 2>&1
sudo apt update --fix-missing >/dev/null 2>&1
clear
echo 
echo ä¿®å¤æ–‡ä»¶æƒé™...
echo 
sudo find ./** |grep $binner |while read line; do
sudo chown -hR $myuser:$myuser "$line"
sudo chmod 777 "$line"
done
sudo chown -hR $myuser:$myuser ./*
sudo chmod -R 777 $LOCALDIR
sudo touch $binner/depment
promenu
fi
}

# é¡¹ç›®èœå•
function promenu()
{
clear
cd $LOCALDIR  
echo -e "\033[34m $(cat $binner/banner) \033[0m"
echo 
  echo -ne "\033[36m â€œ$shijuâ€"
  echo -e "\033[36m---$authorã€Š$fromã€‹\033[0m"
echo -e " \n"
echo -e " >\033[31m é¡¹ç›®åˆ—è¡¨ \033[0m\n"
echo -e "   [0]  æ–°å»ºé¡¹ç›®\n"
pro=0
if ls TI_* >/dev/null 2>&1;then
	for pros in $(ls -d TI_*/| sed 's/\///g')
	do 
	if [ -d "./$pros" ];then
	pro=$((pro+1))
	echo -e "   [$pro]  $pros\n"
	eval "pro$pro=$pros" 
	fi
	done
fi
echo -e "\033[33m  > [j] - è§£å‹    [d] - ä¸‹è½½    [e] - é€€å‡º    [s] - è®¾ç½® \033[0m"
echo -e ""
if [ "$new" == "1" ]; then
	echo -e "\033[32m æ–°ç”¨æˆ·æé†’ ä»…åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶æ˜¾ç¤ºï¼Œé¦–æ¬¡åœ¨ä¸»é¡µé¢é€€å‡ºåï¼Œå°†ä¸å†å‡ºç° \033[0m" 
	echo -e "\033[32m æ–°ç”¨æˆ·æé†’ï¼šMIUIæ›´æ–°åœ°å€ä¸€é”®è·å–åœ¨â€œä¸‹è½½â€é€‰é¡¹ä¸­ \033[0m" 
fi
echo -e " \n"
read -p "  è¯·è¾“å…¥åºå·ï¼š" op_pro
if [ "$op_pro" == "j" ]; then
	unzipp
elif [ "$op_pro" == "d" ]; then
	xiazai
elif [ "$op_pro" == "0" ]; then
	newpro
elif [ "$op_pro" == "e" ]; then
	if [ "$new" == "1" ]; then
	touch $binner/sta
	fi
	clear
	echo  
	echo -n    æ„Ÿ&&sleep 0.2&&echo -n è°¢&&sleep 0.2&&echo -n ä½¿&&sleep 0.2&&echo -n ç”¨&&sleep 0.2&&echo -n T&&sleep 0.2&&echo -n I&&sleep 0.2&&echo -n K&&sleep 0.2&&echo å…¨èƒ½å·¥å…·ç®±ï¼&&sleep 0.2
	echo -n    å¦‚&&sleep 0.1&&echo -n æœ&&sleep 0.1&&echo -n æœ‰&&sleep 0.1&&echo -n èƒ½&&sleep 0.1&&echo -n åŠ›&&sleep 0.1&&echo -n ï¼Œ&&sleep 0.1&&echo -n å¸Œ&&sleep 0.2&&echo -n æœ›&&sleep 0.2&&echo -n æ‚¨&&sleep 0.2&&echo -n èƒ½&&sleep 0.2&&echo -n åˆ†&&sleep 0.2&&echo -n äº«&&sleep 0.2&&echo -n å¹¶&&sleep 0.2&&echo -n å‚&&sleep 0.2&&echo -n ä¸&&sleep 0.2&&echo -n å®Œ&&sleep 0.2&&echo -n å–„&&sleep 0.2&&echo -n è¿™&&sleep 0.2&&echo -n ä¸ª&&sleep 0.2&&echo -n å¼€&&sleep 0.2&&echo -n æº&&sleep 0.2&&echo -n é¡¹&&sleep 0.2&&echo -n ç›®&&sleep 0.2&&echo ï¼
	exit
	clear
elif [ "$op_pro" == "s" ]; then
	settings
elif [[ $op_pro =~ ^-?[1-9][0-9]*$ ]]; then
	if ls TI_* >/dev/null 2>&1;then
	if [ $op_pro -gt $pro ];then
	echo è¾“å…¥æœ‰è¯¯ï¼
	sleep $sleeptime
	promenu
	else
		eval "project=\$pro$op_pro"
		cd $project
		if ls payload >/dev/null 2>&1;then
			payloadmenu
		else
			menu
		fi
	fi
	else
	echo è¾“å…¥æœ‰è¯¯ï¼
	sleep $sleeptime
	promenu
	fi
else
	echo  è¾“å…¥æœ‰è¯¯ï¼
	sleep $sleeptime
	promenu
fi
}


# è§£å‹åˆ¶ä½œ
function unzipp()
{
clear
cd $LOCALDIR
echo -e " \033[31m >ROMåˆ—è¡¨ \033[0m\n"
zipn=0
Yeliqin "   è¯·å°†romæ”¾äº$Sourcedirä¸‹ï¼"
if ls -d $Sourcedir/*.zip >/dev/null 2>&1 || ls -d $Sourcedir/*.ozip >/dev/null 2>&1 ;then
if ls -d $Sourcedir/*.zip >/dev/null 2>&1;then
cd $Sourcedir
	for zip0 in $(ls *.zip)
	do 
	if [ -f "$zip0" ]; then
		zip=$(echo "$zip0" )
		zipn=$((zipn+1))
		echo -e "   [$zipn]- $zip\n"
		eval "zip$zipn=$zip" 
	fi
	done
cd $LOCALDIR
fi
if ls -d $Sourcedir/*.ozip >/dev/null 2>&1 ;then
cd $Sourcedir
	for zip0 in $(ls *.ozip)
	do 
	if [ -f "$zip0" ]; then
		zip=$(echo "$zip0" )
		zipn=$((zipn+1))
		echo -e "   [$zipn]- $zip\n"
		eval "zip$zipn=$zip" 
	fi
	done
cd $LOCALDIR
fi
else
echo "	æ²¡æœ‰ROMæ–‡ä»¶ï¼"
fi
echo -e "-------------------------------------------------------\n"
echo -e ""
read -p "è¯·è¾“å…¥å¯¹åº”åºåˆ—å·ï¼š" zipd
if [[ $zipd =~ ^-?[1-9][0-9]*$ ]]; then
if [ $zipd -gt $zipn ];then
echo "è¾“å…¥æœ‰è¯¯ï¼ï¼"
sleep $sleeptime
promenu
else
eval "zip=\$zip$zipd"
read -p "è¯·è¾“å…¥é¡¹ç›®åç§°(éä¸­æ–‡,å¯ç•™ç©º)ï¼š" projec
if test -z "$projec";then
	echo "è‡ªåŠ¨ä»¥romå‘½åï¼"
	zp=$(echo "$zip" | rev | cut -d'.' -f1 --complement | rev)
	project=TI_$zp
	mkdir $project
else  
	project=TI_$projec
	mkdir $project
fi
sudo chmod -R 777 ./$project
sudo chown -R root:root ./$project
echo "è§£å‹åˆ·æœºåŒ…ä¸­..."
7z x "$Sourcedir/$zip" -o"./$project/" > /dev/null
echo "è§£å‹zipå®Œæˆ"
sleep $sleeptime
cd $project
autounpack
fi
elif [ "$zipd" == "h" ]; then
promenu
else
echo "è¾“å…¥æœ‰è¯¯ï¼ï¼"
sleep $sleeptime
promenu
fi

}


# æ–°å»ºé¡¹ç›®
function newpro()
{
clear
cd $LOCALDIR
echo " "
read -p "è¯·è¾“å…¥é¡¹ç›®åç§°(éä¸­æ–‡)ï¼šTI_" projec
if test -z "$projec";then
  echo "   è¯·é”®å…¥ï¼"
  sleep $sleeptime
  promenu
else  
  project=TI_$projec
  mkdir $project
  menu
fi
}

# ä¸»èœå•
function menu()
{
clear
PROJECT_DIR=$LOCALDIR/$project
cd $PROJECT_DIR
clear
if [[ ! -d "TI_config" ]]; then
mkdir $PROJECT_DIR/TI_config
fi

echo -e " \033[31m >ROMèœå• \033[0m\n"
echo -e " \033[36m  é¡¹ç›®ï¼š$project\n"
if [[ -f $PROJECT_DIR/system/system/build.prop ]]; then
	SYSTEM_DIR="$PROJECT_DIR/system/system"
elif [[ -f $PROJECT_DIR/system/build.prop ]]; then
	SYSTEM_DIR="$PROJECT_DIR/system"
else
	SYSTEM_DIR=0
	echo "	éå®Œæ•´ROMé¡¹ç›®"
fi
if [[ -f $SYSTEM_DIR/build.prop ]]; then
vend=$(cat $SYSTEM_DIR/build.prop | grep "ro.product.manufacturer" | cut -d"=" -f 2)
version=$(cat $SYSTEM_DIR/build.prop | grep "ro.build.version.release=" | cut -d"=" -f 2)
Model=$(cat $SYSTEM_DIR/build.prop | grep "ro.product.mod_device" | cut -d"=" -f 2)
if ! grep -q "ro.product.mod_device" $SYSTEM_DIR/build.prop;then
	Model=$(cat $SYSTEM_DIR/build.prop | grep "ro.product.model" | cut -d"=" -f 2)
fi	
Yeliqin "    æœºå‹ï¼š${vend} ${Model}  ç³»ç»Ÿç‰ˆæœ¬ï¼šAndroid ${version} "
if grep -q "ro.miui." $SYSTEM_DIR/build.prop;then
Yeliqin "    æ£€æµ‹åˆ°ï¼šMIUIç³»ç»Ÿï¼Œå·²å¼€å¯é€‚é…"
export romver=MIUI
fi
fi
echo  
echo -e "\033[34m    ============================\033[0m"
echo -e "\033[31m    1> å›åˆ°ä¸»é¡µ      2> åˆ†è§£èœå•\033[0m" 
echo -e "\033[32m    3> åˆæˆèœå•      4> æ‰©å±•æ’ä»¶\033[0m" 
echo -e "\033[33m    5> æ‰“åŒ…ROM       6> å…¶ä»–æ‚é¡¹\033[0m" 
if [ "$platform" = "aarch64" ];then
echo -e "\033[36m    7> ç§»åŠ¨åˆ†åŒºæ–‡ä»¶\033[0m" 
fi
echo -e "\033[34m    ============================\033[0m"
echo  
read -p "    è¯·è¾“å…¥ç¼–å·: " op_menu
case $op_menu in
        1)
        promenu
        ;;
		2)
        unpmenu
        ;;
		3)
        packmenu
        ;;
		4)
        subbed
        ;;
		5)
        packzip
        ;;
		7)
if [ "$platform" = "aarch64" ];then
        movedir
else
echo è¾“å…¥æœ‰è¯¯ï¼
fi
        ;;
        *)
#       echo -e "è¯·è¾“å…¥æ­£ç¡®ç¼–å·"
        echo -e "æœ¬åŠŸèƒ½æš‚æœªå¼€å‘ï¼"
		sleep $sleeptime
        menu
esac
}

function zhilian()
{
read -p "è¯·è¾“å…¥éœ€è¦ä¸‹è½½ROMçš„ç›´é“¾ï¼š" downrom
if test -z "$downrom"; then
  echo "ä½ è¾“äº†ä¸ªå¯‚å¯"
  sleep $sleeptime
  xiazai
else  
  echo "å¼€å§‹ä¸‹è½½å•¦"
  sleep $sleeptime
  aria2c -s 9 -x 2 $downrom -d $Sourcedir
  zip=$(basename $downrom)
  echo "ä¸‹è½½å®Œæˆï¼"
  sleep $sleeptime
fi
}


function subbed()
{
clear
mkdir $binner/subs
clear
echo  
echo -e " >\033[31m æ’ä»¶åˆ—è¡¨ \033[0m\n"
echo -e "----------------------------------------------\n"
subn=0
cd $binner/subs
for sub in $(ls)
do 
	if [ -d "./$sub" ];then
	subn=$((subn+1))
	echo -e "   [$subn]- $sub\n"
	eval "sub$subn=$sub" 
	fi
done
echo -e "----------------------------------------------\n"
echo -e "\033[33m  > [n] - å®‰è£…    [d] - åˆ é™¤    [e] - é¡¹ç›®èœå•\033[0m"
echo -e ""
read -p "  è¯·è¾“å…¥åºå·ï¼š" op_pro
if [ "$op_pro" == "n" ]; then
	subber
elif [ "$op_pro" == "d" ]; then
	read -p "è¯·è¾“å…¥ä½ è¦åˆ é™¤çš„æ’ä»¶åºå·ï¼š" sub
	eval "sub=\$sub$subn"
	#å†æ¬¡ç¡®è®¤
	rm -fr $sub
	echo åˆ é™¤æˆåŠŸï¼
	sleep $sleeptime
	subbed
elif [ "$op_pro" == "e" ]; then
	menu
elif [[ $op_pro =~ ^-?[1-9][0-9]*$ ]]; then
	if ls >/dev/null 2>&1;then
	if [ $op_pro -gt $subn ];then
	echo è¾“å…¥æœ‰è¯¯ï¼
	sleep $sleeptime
	menu
	else
	#æ£€éªŒæ’ä»¶å®Œæ•´æ€§
		eval "sub=\$sub$subn"
		cd $PROJECT_DIR&&$binner/subs/$sub/run.sh
		subbed
	fi
	else
	echo è¾“å…¥æœ‰è¯¯ï¼
	sleep $sleeptime
	subbed
	fi
else
	echo  è¾“å…¥æœ‰è¯¯ï¼
	sleep $sleeptime
	subbed
fi

}

function subber()
{
clear
cd $LOCALDIR
subn=0
Yeliqin "  è¯·å°†æ’ä»¶æ”¾äº$Sourcedirä¸‹ï¼"
if ls -d $Sourcedir/*.sub >/dev/null 2>&1;then
cd $Sourcedir
	for sub0 in $(ls *.sub)
	do 
	if [ -f "$sub0" ]; then
		sub=$(echo "$sub0" | cut -d'/' -f4)
		subn=$((subn+1))
		echo -e "   [$subn]- $sub\n"
		eval "sub$subn=$sub" 
	fi
	done
cd $LOCALDIR
else
echo "	æ²¡æœ‰æ’ä»¶æ–‡ä»¶ï¼"
fi
echo -e "-------------------------------------------------------\n"
echo -e ""
read -p "è¯·è¾“å…¥å¯¹åº”åºåˆ—å·ï¼š" subd
if [ "$subd" == "0" ]; then
	menu
elif [[ $subd =~ ^-?[1-9][0-9]*$ ]]; then
if [ $subd -gt $subn ];then
echo "è¾“å…¥æœ‰è¯¯ï¼ï¼"
sleep $sleeptime
subber
else
eval "sub=\$sub$subd"
zs=$(echo "$sub" | rev | cut -d'.' -f1 --complement | rev)
mkdir $binner/subs/$zs
echo "å®‰è£…ä¸­..."
7z x "$Sourcedir/$sub" -o"$binner/subs/$zs" > /dev/null
sudo chmod -R 777 $binner/subs/$zs
echo "å®‰è£…å®Œæˆ"
sleep $sleeptime
subbed
fi
elif [ "$zipd" == "h" ]; then
subbed
else
echo "è¾“å…¥æœ‰è¯¯ï¼ï¼"
sleep $sleeptime
subbed
fi
}


function packzip()
{
clear
echo -e "\033[33m 	<-æ‰“åŒ…ZIP \033[0m" 
Yeliqin "	å°†ä¼šæ‰“åŒ…TI_outä¸­å·²æœ‰æ–‡ä»¶"
if [[ ! -d "TI_out" ]]; then
	Yeliqin "	TI_outæ˜¯ç©ºçš„ï¼Œçˆ¬ï¼"
	sleep $sleeptime
else
cd TI_out
#cp -afrv $afrv/dynamic/* ./ > /dev/null
#touch 
Yeliqin "	ğŸ‘´æ²¡å†™å¥½ï¼"
fi
menu
}


function movedir()
{
clear
echo -e "\033[31m<-ç§»åŠ¨é¡¹ç›®æ–‡ä»¶ \033[0m" 
Yeliqin "	å°†ä¼šç§»åŠ¨æœ¬ç›®å½•ä¸‹éƒ¨åˆ†æ–‡ä»¶è‡³/sdcard/$mydir/$project"
fi=0
echo -e "   [0]- è¿”å›èœå•\n"
if ls >/dev/null 2>&1;then
	for fis in $(ls)
	do 
	if [ -d "./$fis" ];then
	fi=$((fi+1))
	if [ "$fis" == "TI_config" ] || [ "$fis" == "TI_out" ];then
	echo -e "\033[31m   [$fi]- $fis\n\033[0m"
	fi
	eval "fi$fi=$fis" 
	fi
	done
fi
echo -e "----------------------------------------------\n"
read -p "  è¯·è¾“å…¥åºå·ï¼š" op
if [[ $op =~ ^-?[1-9][0-9]*$ ]]; then
if [ $op -gt $fi ];then
echo "è¾“å…¥æœ‰è¯¯ï¼ï¼"
sleep $sleeptime
menu
else
eval "mof=\$fi$op"
if [[ ! -d "/sdcard/$mydir/$project" ]]; then
mkdir /sdcard/$mydir/$project
fi
echo ç§»åŠ¨ä¸­...
mv $PROJECT_DIR/$mof /sdcard/$mydir/$project
read -p "  è¯·è‡ªç”±ä¿®æ”¹/sdcard/$mydir/$projectæ–‡ä»¶ï¼Œå®Œæˆåï¼Œå›è½¦ç§»å›é¡¹ç›®æ–‡ä»¶" null
mv /sdcard/$mydir/$project/* $PROJECT_DIR
menu
fi
else
echo "è¾“å…¥æœ‰è¯¯ï¼ï¼"
sleep $sleeptime
menu
fi



}


function miuiupdate()
{
echo -e "\033[31m å›½é™…ä»£å·è¯´æ˜ï¼š[CN]å›½å†…ç‰ˆ [ID]å°å°¼ç‰ˆ [RU]ä¿„ç‰ˆ [Global]å›½é™…ç‰ˆ [EEA]æ¬§ç‰ˆ [TR]åœŸè€³å…¶ç‰ˆ  [TW]å°æ¹¾ç‰ˆ [GP]æ—¥æœ¬ç‰ˆ [SG]æ–°åŠ å¡ç‰ˆ \033[0m" 
read -p "è¯·è¾“å…¥åœ°åŒºä»£å·ï¼š" region
read -p "è¯·è¾“å…¥æœºå‹ä»£å·ï¼š" mod
#åˆ—å‡ºå½“å‰æœºå‹å«æœ‰çš„åœ°åŒºç‰ˆæœ¬
sed -i 's/region = "[^"]*/region = "'$region'/' $binner/get_miui.py
read -p "è¯·é€‰æ‹©ç±»å‹[1]å¡åˆ·åŒ… [2]çº¿åˆ·åŒ…ï¼š" ver
	case "$ver" in
	2)
	  sed -i 's/rom_cleases = "[^"]*/rom_cleases = "fastboot/' $binner/get_miui.py
	  ;;
    *)
      sed -i 's/rom_cleases = "[^"]*/rom_cleases = "recovery/' $binner/get_miui.py
	  esac
echo "[1]å¼€å‘ç‰ˆ [2]ç¨³å®šç‰ˆ" 
read -p "è¯·é€‰æ‹©ç±»å‹ï¼š" ver
	case "$ver" in
	2)
	  sed -i 's/rom_version = "[^"]*/rom_version = "stable/' $binner/get_miui.py
	  ;;
    *)
      sed -i 's/rom_version = "[^"]*/rom_version = "beta/' $binner/get_miui.py
	  esac
miuilink=`python3 $binner/get_miui.py $mod`
echo $miuilink
read -p "æ˜¯å¦å¼€å§‹ä¸‹è½½ï¼Ÿ[1/0]" ver
	case "$ver" in
	1)
	echo "å¼€å§‹ä¸‹è½½å•¦"
	sleep $sleeptime
	aria2c -s 9 -x 2 $miuilink -d $Sourcedir
	zip=$(basename $miuilink)
	echo "ä¸‹è½½å®Œæˆï¼"
	;;
    *)
	echo  
	esac
sleep $sleeptime
xiazai
}

# ä¸‹è½½å™¨
function xiazai()
{
clear
cd $LOCALDIR
echo " "
echo -e "-------------------------------------------------------\n"
echo -e "\033[33m  > [1] - è¿”å›ä¸»é¡µ    [2] - è¾“å…¥ç›´é“¾    [3] - è‡ªåŠ¨è·å–MIUIæ›´æ–°åœ°å€ \033[0m"
read -p "	è¯·è¾“å…¥ç¼–å·: " op_menu
case $op_menu in
        1)
        promenu
        ;;
		2)
        zhilian
        ;;
		3)
        miuiupdate
        ;;
        *)
#       echo -e "è¯·è¾“å…¥æ­£ç¡®ç¼–å·"
        echo -e "æœ¬åŠŸèƒ½æš‚æœªå¼€å‘ï¼"
		sleep $sleeptime
        promenu
esac
}

# è®¾ç½®
function settings()
{
clear
cd $LOCALDIR
echo -e "\033[33m   >è®¾ç½® \033[0m"
echo  
echo " 	1>ä¿®æ”¹ç­‰å¾…æ—¶é—´ "
echo " 	2>ä¿®æ”¹brotliå‹ç¼©ç­‰çº§"
echo " 	3>å¼€/å…³è‡ªåŠ¨è¡¥å…¨config"
echo " 	4>å®‰å“-ä¿®æ”¹å†…ç½®å­˜å‚¨romç›®å½•"
echo " 	5>æ›´æ–°å·¥å…·å†…éƒ¨åˆ†ä¾èµ–"
echo " 	6>è¿”å›ä¸»é¡µ"
echo 
read -p "   è¯·è¾“å…¥ç¼–å·: " op_pro
if [ "$op_pro" == "1" ]; then
	settings1
elif [ "$op_pro" == "2" ]; then
	settings2
elif [ "$op_pro" == "3" ]; then
	settings3
elif [ "$op_pro" == "4" ]; then
	settings4
elif [ "$op_pro" == "4" ]; then
	toolupdate
elif [ "$op_pro" == "6" ]; then
	promenu
else
	echo  è¾“å…¥æœ‰è¯¯ï¼
	sleep $sleeptime
	settings
fi
}

function settings1()
{
echo è°ƒæ•´éƒ¨åˆ†å‘½ä»¤è¾“å‡ºåçš„ç­‰å¾…æ—¶é—´ï¼Œå½“å‰ä¸ºï¼š$sleeptimeç§’
read -p "	è¯·è¾“å…¥ï¼ˆéè´Ÿæ•°ï¼‰: " sleeptime
sed -i 's/^sleeptime=.*/sleeptime='$sleeptime'/'  $binner/settings
source $binner/settings
settings
}
function settings2()
{
echo è°ƒæ•´brotliå‹ç¼©ç­‰çº§ï¼ˆæ•´æ•°1-9ï¼Œçº§åˆ«è¶Šé«˜ï¼Œå‹ç¼©ç‡è¶Šå¤§ï¼Œè€—æ—¶è¶Šé•¿ï¼‰ï¼Œå½“å‰ä¸ºï¼š$brcomçº§
read -p "	è¯·è¾“å…¥ï¼ˆ1-9ï¼‰: " brcom
sed -i 's/^brcom=.*/brcom='$brcom'/'  $binner/settings
source $binner/settings
settings
}
function settings3()
{
echo è‡ªåŠ¨è¡¥å…¨configä»¥ç¡®ä¿æƒé™æ­£å¸¸ï¼Œä½†è€—æ—¶è¾ƒé•¿ã€‚å…³é—­åï¼Œæ‚¨æ–°å¢çš„æ–‡ä»¶æ— æ³•ç¡®ä¿æƒé™æ­£å¸¸ã€‚
read -p "	è¯·è¾“å…¥[1/0]: " configcompl
sed -i 's/^configcompl=.*/configcompl='$configcompl'/'  $binner/settings
source $binner/settings
settings
}
function settings4()
{
echo ä¿®æ”¹å®‰å“ç«¯åœ¨å†…ç½®å­˜å‚¨è¯†åˆ«ROMçš„è·¯å¾„ã€‚å½“å‰ä¸º/sdcard/$mydir
read -p "	è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°(è‹±æ–‡): " mydir
sed -i 's/^mydir=.*/mydir='$mydir'/'  $binner/settings
source $binner/settings
settings
}

function toolupdate()
{
echo   æš‚æœªå¼€å‘ï¼
sleep $sleeptime
settings
}


checkpath